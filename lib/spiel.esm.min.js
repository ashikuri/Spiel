"use strict";function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}function getCjsExportFromNamespace(t){return t&&t.default||t}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */Object.defineProperty(exports,"__esModule",{value:!0});var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function __rest(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]])}return n}function __decorate(t,e,n,i){var a,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(o=(r<3?a(o):r>3?a(e,n,o):a(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function __param(t,e){return function(n,i){e(n,i,t)}}function __metadata(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function __awaiter(t,e,n,i){return new(n||(n=Promise))((function(a,r){function o(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){t.done?a(t.value):new n((function(e){e(t.value)})).then(o,s)}c((i=i.apply(t,e||[])).next())}))}function __generator(t,e){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(a=2&r[0]?i.return:r[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function __exportStar(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function __read(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,a,r=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(t){a={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o}function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),a=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i}function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}function __asyncGenerator(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,a=n.apply(t,e||[]),r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(t){a[t]&&(i[t]=function(e){return new Promise((function(n,i){r.push([t,e,n,i])>1||s(t,e)}))})}function s(t,e){try{(n=a[t](e)).value instanceof __await?Promise.resolve(n.value.v).then(c,u):h(r[0][2],n)}catch(t){h(r[0][3],t)}var n}function c(t){s("next",t)}function u(t){s("throw",t)}function h(t,e){t(e),r.shift(),r.length&&s(r[0][0],r[0][1])}}function __asyncDelegator(t){var e,n;return e={},i("next"),i("throw",(function(t){throw t})),i("return"),e[Symbol.iterator]=function(){return this},e;function i(i,a){e[i]=t[i]?function(e){return(n=!n)?{value:__await(t[i](e)),done:"return"===i}:a?a(e):e}:a}}function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,a){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,a,(e=t[n](e)).done,e.value)}))}}}function __makeTemplateObject(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function __importStar(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function __importDefault(t){return t&&t.__esModule?t:{default:t}}var tslib_es6=Object.freeze({__proto__:null,__extends:__extends,get __assign(){return __assign},__rest:__rest,__decorate:__decorate,__param:__param,__metadata:__metadata,__awaiter:__awaiter,__generator:__generator,__exportStar:__exportStar,__values:__values,__read:__read,__spread:__spread,__spreadArrays:__spreadArrays,__await:__await,__asyncGenerator:__asyncGenerator,__asyncDelegator:__asyncDelegator,__asyncValues:__asyncValues,__makeTemplateObject:__makeTemplateObject,__importStar:__importStar,__importDefault:__importDefault}),EventEmitter_1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.events={}}return t.prototype.emit=function(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return t in this.events&&((e=this.events)[t].apply(e,n),!0)},t.prototype.on=function(t,e){this.events[t]=e},t}();e.default=n}));unwrapExports(EventEmitter_1);var InvisibleClass_1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.ianim=0,this.iout=0,this.nTick=0}return t.prototype.anim=function(){var t=this;return function(e,n){var i=this;void 0===n&&(n=function(t){}),void 0===t.startAnim&&(t.startAnim=Math.trunc(Date.now()+this.animationSpeed));var a=Object.assign({},{x:0,y:0},e),r=Array.isArray(a.x)?a.x.length:Array.isArray(a.y)?a.y.length:[0].length;Array.isArray(a.x)||(this.sprit.x=a.x),Array.isArray(a.y)||(this.sprit.y=a.y);var o=setInterval((function(){t.startAnim<=Math.trunc(Date.now())&&(t.startAnim=void 0,n(t.ianim),t.ianim<r?(Array.isArray(a.x)&&(i.sprit.x=a.x[t.ianim]),Array.isArray(a.y)&&(i.sprit.y=a.y[t.ianim]),void 0===t.startAnim&&(t.startAnim=Math.trunc(Date.now()+i.animationSpeed),t.ianim+=1)):clearInterval(o+(t.ianim=0)))}),1)}},t.prototype.tick=function(t,e){this.nTick++<e&&(t(),this.nTick=0)},t.prototype.timeout=function(){var t=this;return function(e,n,i){void 0===i&&(i=1),void 0===t.startOut&&(t.startOut=Math.trunc(Date.now()+n));var a=setInterval((function(){t.startOut<=Math.trunc(Date.now())&&(t.startOut=void 0,e(t.iout),++t.iout<i?void 0===t.startOut&&(t.startOut=Math.trunc(Date.now()+n)):clearInterval(a+(t.iout=0)))}),1)}},t}();e.default=n}));unwrapExports(InvisibleClass_1);var tslib_1=getCjsExportFromNamespace(tslib_es6),EventEmitter_1$1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.events={}}return t.prototype.emit=function(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return t in this.events&&((e=this.events)[t].apply(e,n),!0)},t.prototype.on=function(t,e){this.events[t]=e},t}();e.default=n}));unwrapExports(EventEmitter_1$1);var InvisibleClass_1$1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.ianim=0,this.iout=0,this.nTick=0}return t.prototype.anim=function(){var t=this;return function(e,n){var i=this;void 0===n&&(n=function(t){}),void 0===t.startAnim&&(t.startAnim=Math.trunc(Date.now()+this.animationSpeed));var a=Object.assign({},{x:0,y:0},e),r=Array.isArray(a.x)?a.x.length:Array.isArray(a.y)?a.y.length:[0].length;Array.isArray(a.x)||(this.sprit.x=a.x),Array.isArray(a.y)||(this.sprit.y=a.y);var o=setInterval((function(){t.startAnim<=Math.trunc(Date.now())&&(t.startAnim=void 0,n(t.ianim),t.ianim<r?(Array.isArray(a.x)&&(i.sprit.x=a.x[t.ianim]),Array.isArray(a.y)&&(i.sprit.y=a.y[t.ianim]),void 0===t.startAnim&&(t.startAnim=Math.trunc(Date.now()+i.animationSpeed),t.ianim+=1)):clearInterval(o+(t.ianim=0)))}),1)}},t.prototype.tick=function(t,e){this.nTick++<e&&(t(),this.nTick=0)},t.prototype.timeout=function(){var t=this;return function(e,n,i){void 0===i&&(i=1),void 0===t.startOut&&(t.startOut=Math.trunc(Date.now()+n));var a=setInterval((function(){t.startOut<=Math.trunc(Date.now())&&(t.startOut=void 0,e(t.iout),++t.iout<i?void 0===t.startOut&&(t.startOut=Math.trunc(Date.now()+n)):clearInterval(a+(t.iout=0)))}),1)}},t}();e.default=n}));unwrapExports(InvisibleClass_1$1);var app=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n,i=tslib_1.__importDefault(EventEmitter_1$1),a=tslib_1.__importDefault(InvisibleClass_1$1),r=new i.default,o=function(t){try{return/^\s*class/.test(t.toString())}catch(t){return!1}};function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new t(e)}e.ex=s,function(t){t.Image=function(t){return new Promise((function(e,n){var i=document.createElement("img");i.title="Image",i.src=t,i.onload=function(){r.emit("loaded"),e(i)},i.onerror=n}))},t.Audio=function(t){return new Promise((function(e,n){var i=document.createElement("audio");i.title="Audio",i.src=t,i.onloadeddata=function(){r.emit("loaded"),e(i)},i.onerror=n}))},t.Text=function(t,e){return new Promise((function(n,i){var a="fontSize"in(e||{})?e.fontSize:10,o="fontFamily"in(e||{})?e.fontFamily:"sans-serif",s="color"in(e||{})?e.color:"#000",c="alpha"in(e||{})?e.alpha:1,u="padding"in(e||{})?e.padding:5;setTimeout((function(){r.emit("loaded"),n({fontSize:a,fontFamily:o,color:s,text:t,alpha:c,padding:u,title:"Text"})}),1)}))}}(e.Loader||(e.Loader={})),function(t){var e=function(){function t(){this.index=1,this.body=null,this.scale=1,this.hidden=!1,this.fixed=!1,this.key=[]}return t.prototype.init=function(){},t.prototype.afterRedraw=function(){},t.prototype.redraw=function(){},t.prototype.beforeRedraw=function(){},t.prototype.tick=function(t,e){},t.prototype.timeout=function(t,e,n){},t.prototype.changeScene=function(t){},t.prototype.audio=function(t){return document.createElement("audio")},t.prototype.collide=function(t,e){return!1},t.prototype.getEntity=function(t){return Object.assign({},this)},t}();t.Image=e;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.replaced=[],e}return tslib_1.__extends(e,t),e.prototype.setFontSize=function(t){},e.prototype.setFontFamily=function(t){},e.prototype.setColor=function(t){},e.prototype.setAlpha=function(t){},e.prototype.setPadding=function(t){},e.prototype.getFontSize=function(){return 0},e.prototype.getFontFamily=function(){return""},e.prototype.getColor=function(){return""},e.prototype.getAlpha=function(){return 0},e.prototype.getPadding=function(){return 0},e}(e);t.Text=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprit={x:0,y:0},e.animationSpeed=300,e}return tslib_1.__extends(e,t),e.prototype.animation=function(t,e){},e}(e);t.Sprit=i;var a=function(){function t(){this.x=0,this.y=0}return t.prototype.init=function(){},t.prototype.update=function(){},t.prototype.tick=function(t,e){},t.prototype.timeout=function(t,e,n){},t.prototype.audio=function(t){return document.createElement("audio")},t.prototype.getEntity=function(t){return Object.assign({},this)},t.prototype.getTarget=function(){return Object.assign({},this)},t.prototype.setTarget=function(t){},t}();t.Camera=a}(n=e.Entity||(e.Entity={}));var c=function(){function t(t,e,n){var i=this;void 0===e&&(e=800),void 0===n&&(n=600),this.w=e,this.h=n,this.fps=60,this.state={},this.key=[],this.audio={},this.saveObject={},this.load={},this.camera={},this.cameraBackground={},this.target={},this.state=t.state||{},this.canvas=t.canvas?t.canvas:document.body.appendChild(document.createElement("canvas")),this.canvas.height=this.h,this.canvas.width=this.w,this.context=this.canvas.getContext("2d"),t.pixel&&(this.canvas.style.imageRendering="pixelated"),this.scenes=t.scene,this.sceneId=0,this.use=this.scenes[this.sceneId].name;var a=function(e){t.load[e].then((function(t){t instanceof HTMLAudioElement?i.audio[e]=t:i.load[e]=t}))};for(var o in t.load)a(o);var s=0,c=Object.keys(t.load).length;r.on("loaded",(function(){i.context.clearRect(0,0,i.w,i.h),++s===c?i.start(t):"loadScene"in t&&t.loadScene(i.context,100*Math.round(s/c))}))}return t.prototype.createSaveJson=function(){var t={currentSceneId:this.sceneId,currentSceneName:this.use,allScene:Object.assign({},this.saveObject)};for(var e in t.allScene)for(var n in t.allScene[e])delete t.allScene[e][n].canvas,t.allScene[e][n].key=[];return JSON.stringify(t)},t.prototype.setEntity=function(t,e,i,r){var o=this,s=new a.default,c=e.entity[i];void 0===c.x&&(c.x=0),void 0===c.y&&(c.y=0),c.scene=e,c.game=this,c.canvas=this.canvas,c.timeout=s.timeout(),c.tick=s.tick,c.getEntity=function(t){if(e.entity[t]instanceof n.Camera)throw new TypeError("You can't get the camera");return Object.assign({},e.entity[t])},c.audio=function(e){if(!(e in t.load))throw new ReferenceError(e+" is not loaded or defined with this name");if(e in o.audio)return o.audio[e];throw new TypeError(e+" is not Audio Element")},c instanceof n.Camera||"@camera"===i?c instanceof n.Camera&&"@camera"===i&&(c.getTarget=function(){return o.target[o.sceneId]},c.setTarget=function(t){if(e.entity[t]instanceof n.Camera)throw new TypeError("You can't target the camera");o.target[o.sceneId]=e.entity[t]}):(c.changeScene=function(t){o.sceneId=o.scenes.findIndex((function(e){return e.name===t})),-1!==o.sceneId&&(o.sceneId in o.saveObject||(o.saveObject[o.sceneId]=o.scenes[o.sceneId].entity),o.use=o.scenes[o.sceneId].name)},r instanceof HTMLImageElement?(void 0===c.entityWidth&&(c.entityWidth=r.width),void 0===c.entityHeight&&(c.entityHeight=r.height),c.collide=function(t,n){return void 0===n&&(n=null),null===n?null===e.entity[t].body?this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y:this.x<e.entity[t].x+e.entity[t].body.x+e.entity[t].body.width&&this.x+this.entityWidth>e.entity[t].x+e.entity[t].body.x&&this.y<e.entity[t].y+e.entity[t].body.y+e.entity[t].body.height&&this.y+this.entityHeight>e.entity[t].y+e.entity[t].body.y:this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+n*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y||this.x<e.entity[t].x+n*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y||this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale-n*e.entity[t].scale||this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale-n*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y},c instanceof n.Sprit&&(c.animation=s.anim())):(c.setFontSize=function(t){r.fontSize=t},c.setFontFamily=function(t){r.fontFamily=t},c.setColor=function(t){r.color=t},c.setAlpha=function(t){r.alpha=t},c.setPadding=function(t){r.padding=t},c.getFontSize=function(){return r.fontSize},c.getFontFamily=function(){return r.fontFamily},c.getColor=function(){return r.color},c.getAlpha=function(){return r.alpha},c.getPadding=function(){return r.padding}))},t.prototype.start=function(t){var e=this;window.onkeydown=function(t){t.preventDefault();var n=[t.ctrlKey?"Ctrl":null,t.altKey?"Alt":null,t.shiftKey?"Shift":null,"Control"===t.key||"Alt"===t.key||"Shift"===t.key?null:"Deconste"===t.key?"Del":" "===t.key?"Space":t.key].filter((function(t){return null!==t})).join("+");"Alt+F4"!==n&&t.preventDefault(),e.key.find((function(t){return t===n}))||e.key.push(n)},window.onkeyup=function(t){return e.key=e.key.filter((function(e){return e!==[t.ctrlKey||"Control"===t.key?"Ctrl":null,t.altKey||"Alt"===t.key?"Alt":null,t.shiftKey||"Shift"===t.key?"Shift":null,"Control"===t.key||"Alt"===t.key||"Shift"===t.key?null:"Deconste"===t.key?"Del":" "===t.key?"Space":t.key].filter((function(t){return null!==t})).join("+")}))},-1!==this.sceneId&&this.scene(t,this.sceneId)},t.prototype.scene=function(t,e){var n=this;e in this.saveObject||(this.saveObject[e]=this.scenes[e].entity),setTimeout((function(){return tslib_1.__awaiter(n,void 0,void 0,(function(){var n,i,a,r,c,u=this;return tslib_1.__generator(this,(function(h){switch(h.label){case 0:return"@camera"in this.saveObject[e]?(o(this.saveObject[e]["@camera"])&&(this.saveObject[e]["@camera"]=s(this.saveObject[e]["@camera"])),this.setEntity(t,this.scenes[e],"@camera"),this.camera[e]=this.saveObject[e]["@camera"],"init"in this.camera[e]&&(this.camera[e].init(),(t.save||"save"in t)&&(this.camera[e].init=function(){})),n=this.cameraBackground,i=e,[4,this.camera[e].background]):[3,2];case 1:n[i]=h.sent(),this.camera[e].width=this.cameraBackground[e].width,this.camera[e].height=this.cameraBackground[e].height,this.drawCamera(e),h.label=2;case 2:for(a in this.saveObject[e])"@camera"!==a&&(o(this.saveObject[e][a])&&(this.saveObject[e][a]=s(this.saveObject[e][a])),this.setEntity(t,this.scenes[e],a,this.load[a]||this.load[this.saveObject[e][a].useImage]),"init"in this.saveObject[e][a]&&(this.saveObject[e][a].init(),(t.save||"save"in t)&&(this.saveObject[e][a].init=function(){})),this.draw(a,e));return r=0,setInterval((function(){u.fps=r,r=0}),1e3),c=function(){r++,u.context.clearRect(0,0,u.w,u.h),u.update(t,e),u.use===u.scenes[e].name?requestAnimationFrame(c):-1!==e&&u.scene(t,u.sceneId)},requestAnimationFrame(c),[2]}}))}))}))},t.prototype.drawCamera=function(t){this.context.drawImage(this.cameraBackground[t],this.camera[t].x,this.camera[t].y)},t.prototype.draw=function(t,e){var n=this;if(t in this.saveObject[e]){var i=this.load[this.saveObject[e][t].use]||this.load[t];if(i instanceof HTMLImageElement)"sprit"in this.saveObject[e][t]?this.context.drawImage(i,this.saveObject[e][t].entityWidth*this.saveObject[e][t].sprit.x,this.saveObject[e][t].entityHeight*this.saveObject[e][t].sprit.y,this.saveObject[e][t].entityWidth,this.saveObject[e][t].entityHeight,this.saveObject[e][t].x+(void 0===this.camera[e]||this.saveObject[e][t].fixed?0:this.camera[e].x),this.saveObject[e][t].y+(void 0===this.camera[e]||this.saveObject[e][t].fixed?0:this.camera[e].y),this.saveObject[e][t].entityWidth*this.saveObject[e][t].scale,this.saveObject[e][t].entityHeight*this.saveObject[e][t].scale):this.context.drawImage(i,this.saveObject[e][t].x+(void 0===this.camera[e]||this.saveObject[e][t].fixed?0:this.camera[e].x),this.saveObject[e][t].y+(void 0===this.camera[e]||this.saveObject[e][t].fixed?0:this.camera[e].y),this.saveObject[e][t].entityWidth*this.saveObject[e][t].scale,this.saveObject[e][t].entityHeight*this.saveObject[e][t].scale);else if(!(i instanceof HTMLAudioElement)){var a=i.text;"replaced"in this.saveObject[e][t]&&tslib_1.__spreadArrays([["",""]],this.saveObject[e][t].replaced).forEach((function(i){a=a.replace.apply(a,i).replace(/\*[a-z0-9_]+/i,(function(i){return i.slice(1)in n.saveObject[e][t]?n.saveObject[e][t][i.slice(1)]:i}))})),this.context.font=i.fontSize*this.saveObject[e][t].scale+"px "+i.fontFamily,this.context.globalAlpha=i.alpha,this.context.fillStyle=i.color,a.split("\n").forEach((function(a,r){n.context.fillText(a.trim(),n.saveObject[e][t].x+(void 0===n.camera[e]||n.saveObject[e][t].fixed?0:n.camera[e].x),n.saveObject[e][t].y+(void 0===n.camera[e]||n.saveObject[e][t].fixed?0:n.camera[e].y)+(i.fontSize+i.padding)*r)}))}}},t.prototype.update=function(t,e){var n=this;if(!this.scenes[e].backgroundColor&&!t.darkmode&&"darkmode"in t||(this.context.save(),this.context.fillStyle=this.scenes[e].backgroundColor?this.scenes[e].backgroundColor:"#000",this.context.rect(0,0,this.w,this.h),this.context.fill(),this.context.restore()),void 0!==this.camera[e]){if(this.target[e]){var i=this.target[e];if(this.canvas.width/2<=i.x+i.entityWidth/2){var a=null;a=this.camera[e].width-this.canvas.width/2<=i.x+i.entityWidth/2&&this.camera[e].x<=this.canvas.width-this.camera[e].width?this.canvas.width-this.camera[e].width:this.canvas.width/2-(i.x+i.entityWidth/2),this.camera[e].x=Math.round(a)}if(this.canvas.height/2<=i.y+i.entityHeight/2){a=null;a=this.camera[e].height-this.canvas.height/2<=i.y+i.entityHeight/2&&this.camera[e].y<=this.canvas.height-this.camera[e].height?this.canvas.height-this.camera[e].height:this.canvas.height/2-(i.y+i.entityHeight/2),this.camera[e].y=Math.round(a)}}this.drawCamera(e),this.camera[e].update()}for(var r=0,o=Object.keys(this.saveObject[e]).filter((function(t){return"@camera"!==t})).sort((function(t,i){return n.saveObject[e][t].index-n.saveObject[e][i].index}));r<o.length;r++){var s=o[r];this.saveObject[e][s].key=this.key,"beforeRedraw"in this.saveObject[e][s]&&this.saveObject[e][s].beforeRedraw(),"redraw"in this.saveObject[e][s]&&this.saveObject[e][s].redraw(),this.saveObject[e][s].hidden||this.draw(s,e),"afterRedraw"in this.saveObject[e][s]&&this.saveObject[e][s].afterRedraw()}},t}();e.Game=c})),app$1=unwrapExports(app),app_1=app.ex,app_2=app.Loader,app_3=app.Entity,app_4=app.Game;exports.Entity=app_3,exports.Game=app_4,exports.Loader=app_2,exports.default=app$1,exports.ex=app_1;
