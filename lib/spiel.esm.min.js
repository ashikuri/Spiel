"use strict";function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */}Object.defineProperty(exports,"__esModule",{value:!0});var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function __rest(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}function __decorate(t,e,n,i){var r,a=arguments.length,s=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(s=(a<3?r(s):a>3?r(e,n,s):r(e,n))||s);return a>3&&s&&Object.defineProperty(e,n,s),s}function __param(t,e){return function(n,i){e(n,i,t)}}function __metadata(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function __awaiter(t,e,n,i){return new(n||(n=Promise))((function(r,a){function s(t){try{c(i.next(t))}catch(t){a(t)}}function o(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(s,o)}c((i=i.apply(t,e||[])).next())}))}function __generator(t,e){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}function __exportStar(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function __read(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,a=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=a.next()).done;)s.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return s}function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var a=arguments[e],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i}function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}function __asyncGenerator(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(t,e||[]),a=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(t){r[t]&&(i[t]=function(e){return new Promise((function(n,i){a.push([t,e,n,i])>1||o(t,e)}))})}function o(t,e){try{(n=r[t](e)).value instanceof __await?Promise.resolve(n.value.v).then(c,u):h(a[0][2],n)}catch(t){h(a[0][3],t)}var n}function c(t){o("next",t)}function u(t){o("throw",t)}function h(t,e){t(e),a.shift(),a.length&&o(a[0][0],a[0][1])}}function __asyncDelegator(t){var e,n;return e={},i("next"),i("throw",(function(t){throw t})),i("return"),e[Symbol.iterator]=function(){return this},e;function i(i,r){e[i]=t[i]?function(e){return(n=!n)?{value:__await(t[i](e)),done:"return"===i}:r?r(e):e}:r}}function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}}function __makeTemplateObject(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function __importStar(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function __importDefault(t){return t&&t.__esModule?t:{default:t}}var domain,tslib_es6=Object.freeze({__proto__:null,__extends:__extends,get __assign(){return __assign},__rest:__rest,__decorate:__decorate,__param:__param,__metadata:__metadata,__awaiter:__awaiter,__generator:__generator,__exportStar:__exportStar,__values:__values,__read:__read,__spread:__spread,__spreadArrays:__spreadArrays,__await:__await,__asyncGenerator:__asyncGenerator,__asyncDelegator:__asyncDelegator,__asyncValues:__asyncValues,__makeTemplateObject:__makeTemplateObject,__importStar:__importStar,__importDefault:__importDefault});function EventHandlers(){}function EventEmitter(){EventEmitter.init.call(this)}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,n){if(e)t.call(n);else for(var i=t.length,r=arrayClone(t,i),a=0;a<i;++a)r[a].call(n)}function emitOne(t,e,n,i){if(e)t.call(n,i);else for(var r=t.length,a=arrayClone(t,r),s=0;s<r;++s)a[s].call(n,i)}function emitTwo(t,e,n,i,r){if(e)t.call(n,i,r);else for(var a=t.length,s=arrayClone(t,a),o=0;o<a;++o)s[o].call(n,i,r)}function emitThree(t,e,n,i,r,a){if(e)t.call(n,i,r,a);else for(var s=t.length,o=arrayClone(t,s),c=0;c<s;++c)o[c].call(n,i,r,a)}function emitMany(t,e,n,i){if(e)t.apply(n,i);else for(var r=t.length,a=arrayClone(t,r),s=0;s<r;++s)a[s].apply(n,i)}function _addListener(t,e,n,i){var r,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),s=a[e]):(a=t._events=new EventHandlers,t._eventsCount=0),s){if("function"==typeof s?s=a[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),!s.warned&&(r=$getMaxListeners(t))&&r>0&&s.length>r){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=s.length,emitWarning(o)}}else s=a[e]=n,++t._eventsCount;return t}function emitWarning(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function _onceWrap(t,e,n){var i=!1;function r(){t.removeListener(e,r),i||(i=!0,n.apply(t,arguments))}return r.listener=n,r}function listenerCount(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}function arrayClone(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}EventHandlers.prototype=Object.create(null),EventEmitter.EventEmitter=EventEmitter,EventEmitter.usingDomains=!1,EventEmitter.prototype.domain=void 0,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.init=function(){this.domain=null,EventEmitter.usingDomains&&domain.active&&domain.Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t){var e,n,i,r,a,s,o,c="error"===t;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(o=this.domain,c){if(e=arguments[1],!o){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=o,e.domainThrown=!1,o.emit("error",e),!1}if(!(n=s[t]))return!1;var h="function"==typeof n;switch(i=arguments.length){case 1:emitNone(n,h,this);break;case 2:emitOne(n,h,this,arguments[1]);break;case 3:emitTwo(n,h,this,arguments[1],arguments[2]);break;case 4:emitThree(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),a=1;a<i;a++)r[a-1]=arguments[a];emitMany(n,h,this,r)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var n,i,r,a,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new EventHandlers:(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,a=n.length;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){s=n[a].listener,r=a;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete i[t]}else spliceOne(n,r);i.removeListener&&this.emit("removeListener",t,s||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new EventHandlers:delete n[t]),this;if(0===arguments.length){for(var i,r=Object.keys(n),a=0;a<r.length;++a)"removeListener"!==(i=r[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},EventEmitter.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:unwrapListeners(e):[]},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var InvisibleClass_1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.i=0}return t.prototype.anim=function(){var t=this;return function(e,n){var i=this;void 0===n&&(n=function(t){}),void 0===t.startAnim&&(t.startAnim=10*Math.trunc((Date.now()+this.animationSpeed)/10));var r=Object.assign({},{x:0,y:0},e),a=Array.isArray(r.x)?r.x.length:Array.isArray(r.y)?r.y.length:[0].length;Array.isArray(r.x)||(this.sprit.x=r.x),Array.isArray(r.y)||(this.sprit.y=r.y);var s=setInterval((function(){t.startAnim===10*Math.trunc(Date.now()/10)&&(t.startAnim=void 0,n(t.i),t.i<a?(Array.isArray(r.x)&&(i.sprit.x=r.x[t.i]),Array.isArray(r.y)&&(i.sprit.y=r.y[t.i]),void 0===t.startAnim&&(t.startAnim=10*Math.trunc((Date.now()+i.animationSpeed)/10),t.i+=1)):clearInterval(s+(t.i=0)))}),10)}},t.prototype.timeout=function(){var t=this;return function(e,n,i){void 0===e&&(e=function(t){}),void 0===i&&(i=1),void 0===t.startOut&&(t.startOut=10*Math.trunc((Date.now()+n)/10));var r=setInterval((function(){t.startOut<=10*Math.trunc(Date.now()/10)&&(t.startOut=void 0,e(t.i),++t.i<i?void 0===t.startOut&&(t.startOut=10*Math.trunc((Date.now()+n)/10)):clearInterval(r+(t.i=0)))}),10)}},t}();e.default=n}));unwrapExports(InvisibleClass_1);var InvisibleClass_1$1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.i=0}return t.prototype.anim=function(){var t=this;return function(e,n){var i=this;void 0===n&&(n=function(t){}),void 0===t.startAnim&&(t.startAnim=10*Math.trunc((Date.now()+this.animationSpeed)/10));var r=Object.assign({},{x:0,y:0},e),a=Array.isArray(r.x)?r.x.length:Array.isArray(r.y)?r.y.length:[0].length;Array.isArray(r.x)||(this.sprit.x=r.x),Array.isArray(r.y)||(this.sprit.y=r.y);var s=setInterval((function(){t.startAnim===10*Math.trunc(Date.now()/10)&&(t.startAnim=void 0,n(t.i),t.i<a?(Array.isArray(r.x)&&(i.sprit.x=r.x[t.i]),Array.isArray(r.y)&&(i.sprit.y=r.y[t.i]),void 0===t.startAnim&&(t.startAnim=10*Math.trunc((Date.now()+i.animationSpeed)/10),t.i+=1)):clearInterval(s+(t.i=0)))}),10)}},t.prototype.timeout=function(){var t=this;return function(e,n,i){void 0===e&&(e=function(t){}),void 0===i&&(i=1),void 0===t.startOut&&(t.startOut=10*Math.trunc((Date.now()+n)/10));var r=setInterval((function(){t.startOut<=10*Math.trunc(Date.now()/10)&&(t.startOut=void 0,e(t.i),++t.i<i?void 0===t.startOut&&(t.startOut=10*Math.trunc((Date.now()+n)/10)):clearInterval(r+(t.i=0)))}),10)}},t}();e.default=n}));unwrapExports(InvisibleClass_1$1);var app=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=tslib_es6.__importDefault(InvisibleClass_1$1),i=new EventEmitter.EventEmitter;var r,a=function(t){try{return/^\s*class/.test(t.toString())}catch(t){return!1}};function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new t(e)}e.ex=s,function(t){t.Image=function(t){return new Promise((function(e,n){var r=document.createElement("img");r.title="Image",r.src=t,r.onload=function(){i.emit("loaded"),e(r)},r.onerror=n}))},t.Audio=function(t){return new Promise((function(e,n){var r=document.createElement("audio");r.title="Audio",r.src=t,r.onloadeddata=function(){i.emit("loaded"),e(r)},r.onerror=n}))},t.Text=function(t,e){return new Promise((function(n,r){var a="fontSize"in(e||{})?e.fontSize:10,s="fontFamily"in(e||{})?e.fontFamily:"sans-serif",o="color"in(e||{})?e.color:"#000",c="alpha"in(e||{})?e.alpha:0,u="padding"in(e||{})?e.alpha:16;setTimeout((function(){i.emit("loaded"),n({fontSize:a,fontFamily:s,color:o,text:t,alpha:c,padding:u,title:"Text"})}),1)}))}}(e.Loader||(e.Loader={})),function(t){var e=function(){function t(){this.body=null,this.scale=1,this.hidden=!1,this.key=[]}return t.prototype.init=function(){},t.prototype.afterRedraw=function(){},t.prototype.redraw=function(){},t.prototype.beforeRedraw=function(){},t.prototype.on=function(t,e){"click"===t&&function(t,e){t.canvas.addEventListener("click",(function(n){var i=Math.abs(t.canvas.offsetLeft-n.x),r=Math.abs(t.canvas.offsetTop-n.y);t.x<=i&&t.x+t.entityWidth>=i&&t.y<=r&&t.y+t.entityWidth>=r&&e(Object.assign({},n,{x:i,y:r}))}))}(this,e)},t.prototype.changeScene=function(t){},t.prototype.audio=function(t){return document.createElement("audio")},t.prototype.collide=function(t,e){return!1},t.prototype.getEntity=function(t){return Object.assign({},this)},t}();t.Image=e;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.replaced=[],e}return tslib_es6.__extends(e,t),e}(e);t.Text=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprit={x:0,y:0},e.animationSpeed=300,e}return tslib_es6.__extends(e,t),e.prototype.animation=function(t,e){},e}(e);t.Sprit=i;var r=function(){function t(){this.x=0,this.y=0}return t.prototype.init=function(){},t.prototype.update=function(){},t.prototype.audio=function(t){return document.createElement("audio")},t.prototype.getEntity=function(t){return Object.assign({},this)},t.prototype.getTarget=function(){return Object.assign({},this)},t.prototype.setTarget=function(t){},t}();t.Camera=r}(r=e.Entity||(e.Entity={}));var o=function(){function t(t,e,n){var r=this;void 0===e&&(e=800),void 0===n&&(n=600),this.w=e,this.h=n,this.key=[],this.saveObject={},this.load={},this.camera={},this.cameraBackground={},this.target={},this.canvas=t.canvas||document.body.appendChild(document.createElement("canvas")),t.pixel&&(this.canvas.style.imageRendering="pixelated"),!t.darkmode&&"darkmode"in t||(this.canvas.style.backgroundColor="#000"),this.context=this.canvas.getContext("2d"),this.scenes=t.scene,this.canvas.height=this.h,this.canvas.width=this.w,this.sceneId=0,this.use=this.scenes[this.sceneId].name;var o=function(e){t.load[e].then((function(n){r.load[e]=n,r.scenes.forEach((function(i){e in i.entity&&(a(i.entity[e])&&(i.entity[e]=s(i.entity[e])),r.setEntity(t,i,e,n))}))}))};for(var c in t.load)o(c);var u=0,h=Object.keys(t.load).length;i.on("loaded",(function(){++u===h?r.start(t):"loadScene"in t&&(r.context.clearRect(0,0,r.w,r.h),t.loadScene(r.context,u/h*100))}))}return t.prototype.createSaveJson=function(){var t={currentSceneId:this.sceneId,currentSceneName:this.use,allScene:Object.assign({},this.saveObject)};for(var e in t.allScene)for(var n in t.allScene[e])delete t.allScene[e][n].canvas,t.allScene[e][n].key=[];return JSON.stringify(t)},t.prototype.setEntity=function(t,e,i,a){var s=this,o=new n.default;e.entity[i].scene=e,e.entity[i].spielEngine=this,e.entity[i].canvas=this.canvas,e.entity[i].timeout=o.timeout(),e.entity[i].getEntity=function(t){if(e.entity[t]instanceof r.Camera)throw new TypeError("You can't get the camera");return Object.assign({},e.entity[t])},e.entity[i].audio=function(e){if(!(e in t.load))throw new ReferenceError(e+" is not loaded or defined with this name");if(e in s.load){if("Audio"!==s.load[e].title)throw new TypeError(e+" is not Audio Element");return s.load[e]}return document.createElement("audio")},e.entity[i]instanceof r.Camera||"@camera"===i?e.entity[i]instanceof r.Camera&&"@camera"===i&&(e.entity[i].getTarget=function(){return s.target[s.sceneId]},e.entity[i].setTarget=function(t){if(e.entity[t]instanceof r.Camera)throw new TypeError("You can't target the camera");s.target[s.sceneId]=e.entity[t]}):(e.entity[i].changeScene=function(t){s.sceneId=s.scenes.findIndex((function(e){return e.name===t})),-1!==s.sceneId&&(s.sceneId in s.saveObject||(s.saveObject[s.sceneId]=s.scenes[s.sceneId].entity),s.use=s.scenes[s.sceneId].name)},a instanceof HTMLImageElement&&(void 0===e.entity[i].entityWidth&&(e.entity[i].entityWidth=a.width),void 0===e.entity[i].entityHeight&&(e.entity[i].entityHeight=a.height),e.entity[i].collide=function(t,n){return void 0===n&&(n=null),null===n?null===e.entity[t].body?this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y:this.x<e.entity[t].x+e.entity[t].body.x+e.entity[t].body.width&&this.x+this.entityWidth>e.entity[t].x+e.entity[t].body.x&&this.y<e.entity[t].y+e.entity[t].body.y+e.entity[t].body.height&&this.y+this.entityHeight>e.entity[t].y+e.entity[t].body.y:this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+n*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y||this.x<e.entity[t].x+n*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y||this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale-n*e.entity[t].scale||this.x<e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale-n*e.entity[t].scale&&this.x+this.entityWidth>e.entity[t].x+e.entity[t].entityWidth*e.entity[t].scale&&this.y<e.entity[t].y+e.entity[t].entityHeight*e.entity[t].scale&&this.y+this.entityHeight>e.entity[t].y},e.entity[i]instanceof r.Sprit&&(e.entity[i].animation=o.anim())))},t.prototype.start=function(t){var e=this;window.onkeydown=function(t){t.preventDefault();var n=[t.ctrlKey?"Ctrl":null,t.altKey?"Alt":null,t.shiftKey?"Shift":null,"Control"===t.key||"Alt"===t.key||"Shift"===t.key?null:"Deconste"===t.key?"Del":" "===t.key?"Space":t.key].filter((function(t){return null!==t})).join("+");"Alt+F4"!==n&&t.preventDefault(),e.key.find((function(t){return t===n}))||e.key.push(n)},window.onkeyup=function(t){return e.key=e.key.filter((function(e){return e!==[t.ctrlKey||"Control"===t.key?"Ctrl":null,t.altKey||"Alt"===t.key?"Alt":null,t.shiftKey||"Shift"===t.key?"Shift":null,"Control"===t.key||"Alt"===t.key||"Shift"===t.key?null:"Deconste"===t.key?"Del":" "===t.key?"Space":t.key].filter((function(t){return null!==t})).join("+")}))},-1!==this.sceneId&&this.scene(t,this.sceneId)},t.prototype.scene=function(t,e){var n=this;e in this.saveObject||(this.saveObject[e]=this.scenes[e].entity),setTimeout((function(){return tslib_es6.__awaiter(n,void 0,void 0,(function(){var n,i,r,o,c=this;return tslib_es6.__generator(this,(function(u){switch(u.label){case 0:return"@camera"in this.saveObject[e]?(a(this.saveObject[e]["@camera"])&&(this.saveObject[e]["@camera"]=s(this.saveObject[e]["@camera"])),this.setEntity(t,this.scenes[e],"@camera"),this.camera[e]=this.saveObject[e]["@camera"],"init"in this.camera[e]&&(this.camera[e].init(),(t.save||"save"in t)&&(this.camera[e].init=function(){})),n=this.cameraBackground,i=e,[4,this.camera[e].background]):[3,2];case 1:n[i]=u.sent(),this.camera[e].width=this.cameraBackground[e].width,this.camera[e].height=this.cameraBackground[e].height,this.drawCamera(e),u.label=2;case 2:for(r in this.saveObject[e])"@camera"!==r&&("init"in this.saveObject[e][r]&&(this.saveObject[e][r].init(),(t.save||"save"in t)&&(this.saveObject[e][r].init=function(){})),this.draw(r,e));return o=function(){c.context.clearRect(0,0,c.w,c.h),c.update(e),c.use===c.scenes[e].name?requestAnimationFrame(o):-1!==e&&c.scene(t,c.sceneId)},requestAnimationFrame(o),[2]}}))}))}))},t.prototype.drawCamera=function(t){this.context.drawImage(this.cameraBackground[t],this.camera[t].x,this.camera[t].y)},t.prototype.draw=function(t,e){var n=this;if(this.scenes[e].backgroundColor&&(this.canvas.style.backgroundColor=this.scenes[e].backgroundColor),t in this.load){var i=this.load[t];if(i instanceof HTMLImageElement)"sprit"in this.saveObject[e][t]?this.context.drawImage(i,this.saveObject[e][t].entityWidth*this.saveObject[e][t].sprit.x,this.saveObject[e][t].entityHeight*this.saveObject[e][t].sprit.y,this.saveObject[e][t].entityWidth,this.saveObject[e][t].entityHeight,this.saveObject[e][t].x+(void 0===this.camera[e]?0:this.camera[e].x),this.saveObject[e][t].y+(void 0===this.camera[e]?0:this.camera[e].y),this.saveObject[e][t].entityWidth*this.saveObject[e][t].scale,this.saveObject[e][t].entityHeight*this.saveObject[e][t].scale):this.context.drawImage(i,this.saveObject[e][t].x+(void 0===this.camera[e]?0:this.camera[e].x),this.saveObject[e][t].y+(void 0===this.camera[e]?0:this.camera[e].y),this.saveObject[e][t].entityWidth*this.saveObject[e][t].scale,this.saveObject[e][t].entityHeight*this.saveObject[e][t].scale);else if(!(i instanceof HTMLAudioElement)){var r=i.text;"replaced"in this.saveObject[e][t]&&tslib_es6.__spreadArrays([["",""]],this.saveObject[e][t].replaced).forEach((function(i){r=r.replace.apply(r,i).replace(/\*[a-z0-9]+/i,(function(i){return i.slice(1)in n.saveObject[e][t]?n.saveObject[e][t][i.slice(1)]:i}))})),this.context.save(),this.context.font=i.fontSize+"px "+i.fontFamily,this.context.globalAlpha=i.alpha,this.context.fillStyle=i.color,r.split("\n").forEach((function(r,a){n.context.fillText(r.trim(),n.saveObject[e][t].x+(void 0===n.camera[e]?0:n.camera[e].x),n.saveObject[e][t].y+(void 0===n.camera[e]?0:n.camera[e].y)+(i.fontSize+i.padding)*a)})),this.context.restore()}}},t.prototype.update=function(t){if(void 0!==this.camera[t]){if(this.target[t]){var e=this.target[t];if(this.canvas.width/2<=e.x+e.entityWidth/2){var n=null;n=this.camera[t].width-this.canvas.width/2<=e.x+e.entityWidth/2&&this.camera[t].x<=this.canvas.width-this.camera[t].width?this.canvas.width-this.camera[t].width:this.canvas.width/2-(e.x+e.entityWidth/2),this.camera[t].x=Math.round(n)}if(this.canvas.height/2<=e.y+e.entityHeight/2){n=null;n=this.camera[t].height-this.canvas.height/2<=e.y+e.entityHeight/2&&this.camera[t].y<=this.canvas.height-this.camera[t].height?this.canvas.height-this.camera[t].height:this.canvas.height/2-(e.y+e.entityHeight/2),this.camera[t].y=Math.round(n)}}this.drawCamera(t),this.camera[t].update()}for(var i in this.saveObject[t])"@camera"!==i&&(this.saveObject[t][i].key=this.key,"beforeRedraw"in this.saveObject[t][i]&&this.saveObject[t][i].beforeRedraw(),"redraw"in this.saveObject[t][i]&&this.saveObject[t][i].redraw(),this.saveObject[t][i].hidden||this.draw(i,t),"afterRedraw"in this.saveObject[t][i]&&this.saveObject[t][i].afterRedraw())},t}();e.Game=o})),app$1=unwrapExports(app),app_1=app.ex,app_2=app.Loader,app_3=app.Entity,app_4=app.Game;exports.Entity=app_3,exports.Game=app_4,exports.Loader=app_2,exports.default=app$1,exports.ex=app_1;
