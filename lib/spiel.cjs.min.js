"use strict";function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}function getCjsExportFromNamespace(t){return t&&t.default||t}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */Object.defineProperty(exports,"__esModule",{value:!0});var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function __rest(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function __decorate(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function __param(t,e){return function(n,r){e(n,r,t)}}function __metadata(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function __awaiter(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function __generator(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function __exportStar(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function __read(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}function __asyncGenerator(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=i[t](e)).value instanceof __await?Promise.resolve(n.value.v).then(u,c):l(o[0][2],n)}catch(t){l(o[0][3],t)}var n}function u(t){s("next",t)}function c(t){s("throw",t)}function l(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function __asyncDelegator(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:__await(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}function __makeTemplateObject(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function __importStar(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function __importDefault(t){return t&&t.__esModule?t:{default:t}}var domain,tslib_es6=Object.freeze({__proto__:null,__extends:__extends,get __assign(){return __assign},__rest:__rest,__decorate:__decorate,__param:__param,__metadata:__metadata,__awaiter:__awaiter,__generator:__generator,__exportStar:__exportStar,__values:__values,__read:__read,__spread:__spread,__spreadArrays:__spreadArrays,__await:__await,__asyncGenerator:__asyncGenerator,__asyncDelegator:__asyncDelegator,__asyncValues:__asyncValues,__makeTemplateObject:__makeTemplateObject,__importStar:__importStar,__importDefault:__importDefault});function EventHandlers(){}function EventEmitter(){EventEmitter.init.call(this)}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,n){if(e)t.call(n);else for(var r=t.length,i=arrayClone(t,r),o=0;o<r;++o)i[o].call(n)}function emitOne(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=arrayClone(t,i),a=0;a<i;++a)o[a].call(n,r)}function emitTwo(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,a=arrayClone(t,o),s=0;s<o;++s)a[s].call(n,r,i)}function emitThree(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var a=t.length,s=arrayClone(t,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function emitMany(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=arrayClone(t,i),a=0;a<i;++a)o[a].apply(n,r)}function _addListener(t,e,n,r){var i,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]):(o=t._events=new EventHandlers,t._eventsCount=0),a){if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=$getMaxListeners(t))&&i>0&&a.length>i){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,emitWarning(s)}}else a=o[e]=n,++t._eventsCount;return t}function emitWarning(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function _onceWrap(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function listenerCount(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}function arrayClone(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}EventHandlers.prototype=Object.create(null),EventEmitter.EventEmitter=EventEmitter,EventEmitter.usingDomains=!1,EventEmitter.prototype.domain=void 0,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.init=function(){this.domain=null,EventEmitter.usingDomains&&domain.active&&domain.Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t){var e,n,r,i,o,a,s,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(e=arguments[1],!s){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=s,e.domainThrown=!1,s.emit("error",e),!1}if(!(n=a[t]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,l,this);break;case 2:emitOne(n,l,this,arguments[1]);break;case 3:emitTwo(n,l,this,arguments[1],arguments[2]);break;case 4:emitThree(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];emitMany(n,l,this,i)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var n,r,i,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new EventHandlers:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete r[t]}else spliceOne(n,i);r.removeListener&&this.emit("removeListener",t,a||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new EventHandlers:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},EventEmitter.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:unwrapListeners(e):[]},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var events=Object.freeze({__proto__:null,default:EventEmitter,EventEmitter:EventEmitter}),tslib_1=getCjsExportFromNamespace(tslib_es6),events_1=getCjsExportFromNamespace(events),app=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n,r=new events_1.EventEmitter;function i(t,e){t.canvas.addEventListener("click",(function(n){var r=Math.abs(t.canvas.offsetLeft-n.x),i=Math.abs(t.canvas.offsetTop-n.y);t.x<=r&&t.x+t.entityWidth>=r&&t.y<=i&&t.y+t.entityWidth>=i&&e(Object.assign({},n,{x:r,y:i}))}))}e.ex=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new t(e)},function(t){t.Image=function(t){return new Promise((function(e,n){var i=document.createElement("img");i.title="Image",i.src=t,i.onload=function(){r.emit("loaded"),e(i)},i.onerror=n}))},t.Audio=function(t){return new Promise((function(e,n){var i=document.createElement("audio");i.title="Audio",i.src=t,i.onloadeddata=function(){r.emit("loaded"),e(i)},i.onerror=n}))},t.Text=function(t,e){return new Promise((function(n,i){var o="fontSize"in(e||{})?e.fontSize:"10px",a="fontFamily"in(e||{})?e.fontFamily:"sans-serif";setTimeout((function(){r.emit("loaded"),n({font:o+" "+a,text:t,title:"Text"})}),1)}))}}(e.Loader||(e.Loader={})),function(t){var e=function(){function t(){this.replaced=[]}return t.prototype.init=function(){},t.prototype.afterRedraw=function(){},t.prototype.redraw=function(){},t.prototype.beforeRedraw=function(){},t.prototype.on=function(t,e){"click"===t&&i(this,e)},t}();t.Text=e;var n=function(){function t(){this.scale=1,this.key=[]}return t.prototype.init=function(){},t.prototype.afterRedraw=function(){},t.prototype.redraw=function(){},t.prototype.beforeRedraw=function(){},t.prototype.on=function(t,e){"click"===t&&i(this,e)},t.prototype.audio=function(t){return document.createElement("audio")},t.prototype.colide=function(t){return!1},t.prototype.getEntity=function(t){return Object.assign({},this)},t}();t.Image=n;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprit={x:0,y:0},e.animationSpeed=300,e}return tslib_1.__extends(e,t),e.prototype.animation=function(t,e){},e}(n);t.Sprit=r}(n=e.Entity||(e.Entity={}));var o=function(){function t(t,e,i){var o=this;void 0===e&&(e=800),void 0===i&&(i=600),this.w=e,this.h=i,this.key=[],this.load={},this.canvas=t.canvas||document.body.appendChild(document.createElement("canvas")),t.pixel&&(this.canvas.style.imageRendering="pixelated"),!t.darkmode&&"darkmode"in t||(this.canvas.style.backgroundColor="#000"),this.context=this.canvas.getContext("2d"),this.canvas.height=this.h,this.canvas.width=this.w,this.use=t.scene[0].name;var a=function(e){t.load[e].then((function(r){o.load[e]=r,t.scene.forEach((function(i){if(e in i.entity&&(i.entity[e].canvas=o.canvas,r instanceof HTMLImageElement&&(void 0===i.entity[e].entityWidth&&(i.entity[e].entityWidth=r.width),void 0===i.entity[e].entityHeight&&(i.entity[e].entityHeight=r.height),i.entity[e].colide=function(t){return this.x<i.entity[t].x+i.entity[t].entityWidth&&this.x+this.entityWidth>i.entity[t].x&&this.y<i.entity[t].y+i.entity[t].entityHeight&&this.entityHeight+this.y>i.entity[t].y},i.entity[e].getEntity=function(t){return Object.assign({},i.entity[t])},i.entity[e].audio=function(e){if(!(e in t.load))throw new ReferenceError(e+" is not loaded or defined with this name");if(e in o.load){if("Audio"!==o.load[e].title)throw new TypeError(e+" is not Audio Element");return o.load[e]}return document.createElement("audio")},i.entity[e]instanceof n.Sprit))){var a=new(function(){function t(){this.i=0}return t.prototype.anim=function(){var t=this;return function(e,n){var r=this;void 0===n&&(n=function(t){}),void 0===t.start&&(t.start=10*Math.trunc((Date.now()+this.animationSpeed)/10));var i=Object.assign({},{x:0,y:0},e),o=Array.isArray(i.x)?i.x.length:Array.isArray(i.y)?i.y.length:[0].length;Array.isArray(i.x)||(this.sprit.x=i.x),Array.isArray(i.y)||(this.sprit.y=i.y);var a=setInterval((function(){t.start===10*Math.trunc(Date.now()/10)&&(t.start=void 0,n(t.i),t.i<o?(Array.isArray(i.x)&&(r.sprit.x=i.x[t.i]),Array.isArray(i.y)&&(r.sprit.y=i.y[t.i]),void 0===t.start&&(t.start=10*Math.trunc((Date.now()+r.animationSpeed)/10),t.i+=1)):clearInterval(a+(t.i=0)))}),10)}},t}());i.entity[e].animation=a.anim()}}))}))};for(var s in t.load)a(s);var u=0,c=Object.keys(t.load).length;r.on("loaded",(function(){++u===c&&o.start(t)}))}return t.prototype.start=function(t){var e=this;window.onkeydown=function(t){t.key.includes("Arrow")&&t.preventDefault(),e.key.push([t.ctrlKey?"Ctrl":null,t.altKey?"Alt":null,t.shiftKey?"Shift":null,"Control"===t.key||"Alt"===t.key||"Shift"===t.key?null:"Delete"===t.key?"Del":" "===t.key?"Space":t.key].filter((function(t){return null!==t})).join("+"))},window.onkeyup=function(t){return e.key=e.key.filter((function(e){return e!==[t.ctrlKey?"Ctrl":null,t.altKey?"Alt":null,t.shiftKey?"Shift":null,"Control"===t.key||"Alt"===t.key||"Shift"===t.key?null:"Delete"===t.key?"Del":" "===t.key?"Space":t.key].filter((function(t){return null!==t})).join("+")}))};var n=t.scene.findIndex((function(t){return e.use===t.name}));-1!=n&&(this.entityList=t.scene[n].entity,setTimeout((function(){for(var t in e.entityList)"init"in e.entityList[t]&&e.entityList[t].init(),e.draw(t);var n=function(){setTimeout((function(){e.context.clearRect(0,0,e.w,e.h),e.update()})),requestAnimationFrame(n)};requestAnimationFrame(n)})))},t.prototype.draw=function(t){var e=this;if(t in this.load){var n=this.load[t];if(n instanceof HTMLImageElement)"sprit"in this.entityList[t]?this.context.drawImage(n,this.entityList[t].entityWidth*this.entityList[t].sprit.x,this.entityList[t].entityHeight*this.entityList[t].sprit.y,this.entityList[t].entityWidth,this.entityList[t].entityHeight,this.entityList[t].x,this.entityList[t].y,this.entityList[t].entityWidth*this.entityList[t].scale,this.entityList[t].entityHeight*this.entityList[t].scale):this.context.drawImage(n,this.entityList[t].x,this.entityList[t].y,this.entityList[t].entityWidth*this.entityList[t].scale,this.entityList[t].entityHeight*this.entityList[t].scale);else if(!(n instanceof HTMLAudioElement)){var r=n.text;"replaced"in this.entityList[t]&&tslib_1.__spreadArrays([["",""]],this.entityList[t].replaced).forEach((function(n){r=r.replace.apply(r,n).replace(/\*[a-z0-9]+/i,(function(n){return n.slice(1)in e.entityList[t]?e.entityList[t][n.slice(1)]:n}))})),this.context.font=n.font,this.context.fillText(r,this.entityList[t].x,this.entityList[t].y)}}},t.prototype.update=function(){for(var t in this.entityList)this.entityList[t]instanceof n.Image&&(this.entityList[t].key=this.key),"beforeRedraw"in this.entityList[t]&&this.entityList[t].beforeRedraw(),"redraw"in this.entityList[t]&&this.entityList[t].redraw(),this.draw(t),"afterRedraw"in this.entityList[t]&&this.entityList[t].afterRedraw()},t}();e.Game=o})),app$1=unwrapExports(app),app_1=app.ex,app_2=app.Loader,app_3=app.Entity,app_4=app.Game;exports.Entity=app_3,exports.Game=app_4,exports.Loader=app_2,exports.default=app$1,exports.ex=app_1;
